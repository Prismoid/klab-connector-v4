# CADDEテストベッド参加者環境のドメイン登録

CADDEテストベッド参加者は、自らが利用するCADDEユーザアカウントごとに以下のアプリケーションのドメイン名を事前に登録する必要がある。

- データ提供者環境
  - 提供者コネクタ
  - 認可機能
  - 提供者カタログサイト
- データ利用者環境
  - 利用者コネクタ
  - 利用者WebApp

## 注意点

テストベッド参加者は必ずしも複数のCADDEユーザアカウントを利用する必要はないため、CADDE参加者環境の構築・利用に必要なアプリケーションに対してのみドメイン名の登録申請を行えばよい。

例えば、1つのユーザアカウントのみを利用する場合は、上記5つのアプリケーションに対してのみドメイン登録申請を行えばよい。
一方で、2つのユーザアカウントを利用する場合は、上記5つのアプリケーションに対して、それぞれ2つずつ計10（= 5x2）個のドメイン登録申請を行う必要がある。

また、データ利用者環境のみ、もしくはデータ提供者環境のみを構築・利用したい場合など、CADDEテストベッドの利用の仕方に応じて、ドメイン名の登録申請を行うアプリケーションを限定することも可能である。

## 登録申請方法

ドメインの登録申請は以下の手順で行う。

1. **テストベッド参加者**：構築・利用したいアプリケーションの数だけドメイン名を決定する
2. **テストベッド参加者**：以下のフォームからドメイン名の登録を申請する
3. **テストベッド運用者**：テストベッドネットワーク用DNSサーバにて申請されたドメイン名を登録し、テストベッド参加者に通知する

<!-- TODO：申請フォームの準備 -->
[**CADDEテストベッド ドメイン登録・証明書発行申請フォーム**（準備中）](./domain_registration.md)

## ドメインの命名規則

テストベッドネットワークにおけるドメインの命名規則は以下のように定められている（参照：`テストベッドネットワーク概要.pdf`）。
>
> - `<name>.<sitename>.dataspace.internal`
>   - sitenameには各社サブネット固有の名前を割り当て
>   - nameには機能単位で固有の名前を割り当て

ここで、複数のCADDEユーザアカウントを利用する場合を考えると、各アプリケーションのドメイン名を機能単位で命名するだけでは、同一サイト内でドメイン名が重複してしまう場合が考えられる。

そのため、CADDEテストベッドでは、ホスト名にユーザIDの情報を含めることを推奨する。

これに従う場合、以下のフォーマットでドメインを命名することが望ましい。

- **`cadde-<app name>-<serial number>.<sitename>.dataspace.internal`**
  - `cadde-`
    - CADDEアプリケーションであることを示すprefix
  - app name
    - CADDEを構成するアプリケーション名（下表を参照）
  - serial number / sitename
    - CADDEユーザIDに含まれる情報（参照：[CADDEユーザIDの採番規則](./userinfo.md#caddeユーザidの採番規則)）

| アプリケーション   | app name |
| ---------- | -------- |
| 提供者コネクタ    | provider |
| 認可機能       | authz    |
| 提供者カタログサイト | catalog  |
| 利用者コネクタ    | consumer |
| 利用者WebApp  | webapp   |

以下に命名例として、東京大学越塚研究室サイト（`koshizukalab`）に属するCADDEユーザ（`0001-koshizukalab`）が設定すべきドメイン名を示す。

| アプリケーション   | ドメイン名                                            |
| ---------- | ------------------------------------------------ |
| 提供者コネクタ    | `cadde-provider-0001.koshizukalab.dataspace.internal` |
| 認可機能       | `cadde-authz-0001.koshizukalab.dataspace.internal`    |
| 提供者カタログサイト | `cadde-catalog-0001.koshizukalab.dataspace.internal`  |
| 利用者コネクタ    | `cadde-consumer-0001.koshizukalab.dataspace.internal` |
| 利用者WebApp  | `cadde-webapp-0001.koshizukalab.dataspace.internal`   |
